var FavoritesUtil,ImageFavorites,CollectionType;(function(n){function c(n){sj_evt.fire("Favorites.ToggleLearnMore",n)}var e=pMMUtils,r="/",t="_IFAV",i="COUNT",o="SEEALL",h="Favorites",s=["/images/","/images"],u,f;n.instEr="CI.Error";n.instCl="CI.Click",function(n){n[n.Delete=0]="Delete";n[n.Write=1]="Write"}(u=n.TransactionType||(n.TransactionType={})),function(n){n[n.IRP=0]="IRP";n[n.Insights=1]="Insights";n[n.FavoritesPage=2]="FavoritesPage"}(f=n.RequestType||(n.RequestType={}));n.rsc=function(){if(typeof removeCookie!="undefined")for(var n=0;n<s.length;n++)removeCookie(t,s[n])};n.ufcw=function(){var n=parseInt(sj_cook.get(t,i)),u=n+1;sj_cook.set(t,i,u.toString(),!0,r)};n.ufcd=function(){var n=parseInt(sj_cook.get(t,i)),u=n-1;sj_cook.set(t,i,u.toString(),!0,r)};n.ufcr=function(n){var c=_ge("ilp_fg")!=null,f=_ge(n),u,s,h;f!=null&&(u=e.ga(f,"ct"),u!=null&&sj_cook.set(t,i,u,!0,r));c&&(s=parseInt(sj_cook.get(t,o)),h=s+1,sj_cook.set(t,o,h.toString(),!0,r))};n.gmd=function(n){var i=null,t;if(n!=null&&(t=e.ga(n,"m"),t))try{i=eval("("+t+")")}catch(r){return null}return i};n.unsave=function(t,i,r,e){var o=f[i]==f[f.Insights]?r:n.gmd(t),s;if(o!=null&&o.md5!=null)return s={},s.MD5=o.md5,s.ContentId=o.ccid,n.sxhr(s,u.Delete,t,i,e),n.ufcd(),!0};n.sxhr=function(n,t,i,r,f){if(n){var e={purl:n.SourceUrl,murl:n.MediaUrl,cid:n.ContentId,desc:n.description,mid:n.mid,tid:n.ThumbnailId,thW:n.ThWidth,thH:n.ThHeight,md5:n.MD5,mw:n.MediaWidth,mh:n.MediaHeight,format:n.MediaFormat,query:n.query},o=n.CollectionId?{id:n.CollectionId}:n.CollectionType?{collectionType:n.CollectionType}:n.query?{title:n.query}:{collectionType:CollectionType.Other};switch(t){case u.Delete:MmFaves.removeImageFromFavorites(e,f?f:function(){});break;case u.Write:MmFaves.addImageToFavorites(o,e,f?f:function(){})}}};n.lfi=function(n,t,i,r){pInstr.logEvent(n,t,null,h,{Component:i},r)};n.saveState=c;n.gebid=function(t,i,r){var c=_ge(i),u,f,o,s,h;if(c&&t&&(u=e.gebc(r,c),u))for(f=0;f<u.length;f++)if(o=u[f],o&&o.childNodes.length>0&&(s=o.childNodes[0],h=n.gmd(s),h&&h.mid==t))return s;return null};sj_evt.fire("FavUtils.Loaded")})(FavoritesUtil||(FavoritesUtil={})),function(n){function d(){var n=parseQueryParams();r=n.q;r!=null&&typeof r!="undefined"&&(r=decodeURIComponent(r).toLowerCase());t.ufcr("favmd");t.rsc();k=t.gmd(_ge("favmd"));f.bind(w,g);sj_be(_w,p,ut)}function g(t){t&&t.length>2&&n.hfc(t[1],t[2])}function nt(n,i){if(i&&n){var r=t.gmd(i);r&&r.md5&&sj_evt.fire("Favorites.ShowMoveToBalloon",r.md5,n)}}function l(){sj_evt.fire("Favorites.HideMoveToBalloon")}function tt(n,t){n&&t&&!_d.querySelector("#mfavsi.show")&&sj_evt.fire("Favorites.ShowMoveToBalloon",n.md5,t)}function a(n){switch(n){case"can_fav_icon":return"ImageCanvas";case"mb_fav":return"ImageViewer";default:return"Insights"}}function it(n){pMMUtils.ac(n,"fade")}function rt(){var n=parseQueryParams();return n.iss=="rec"?CollectionType.Recommendations:CollectionType.None}function ut(n){var i=MMMessenger.GetMessageData(n),r,u;i&&(r=i.data,r&&r.mid&&(u=t.gebid(r.mid,"vm_c","dg_u"),u&&(i.command==="Favorite.Add"?e(u):i.command==="Favorite.Remove"&&o(u))))}var i=pMMUtils,r="",p="message",w="Favorites.HoverHeartClick",u="saved",t=FavoritesUtil,f=sj_evt,b="/sa/simg/favorite_yellow_13.png",h="tooltip",c="FavoritesStatusChanged",k=null,v,e,o,y,s;n.hfc=function(t,i){return n.hfcc(t,i)};n.hfcc=function(n,i){if(n==null||i==null||n.parentNode==null||i.parentNode==null||i.parentNode.parentNode==null){t.lfi(null,t.instEr,"HoverClick");return}var u=v(i),r=t.gmd(i);r!=null?u?(t.lfi(r.ns,t.instCl,"HoverRemove"),t.unsave(i,t.RequestType.IRP),o(i),f.fire("Favorites.UpdateStatus",!1,n),l()):(t.lfi(r.ns,t.instCl,"HoverAdd"),s(i,t.RequestType.IRP),nt(n,i),e(i),f.fire("Favorites.UpdateStatus",!0,n)):t.lfi(r.ns,t.instEr,"HoverClick")};n.iffbc=function(){if(typeof FavNsiCook!="undefined"){var n=FavNsiCook.gcnsi();return n===null?(FavNsiCook.ucnsi(),!0):!1}return!0};n.hic=function(i,r,u){var e=i.isFav,f;e?(t.lfi(i.ns,t.instCl,a(r.id)+"Remove"),t.unsave(r,t.RequestType.Insights,i),f={},f.mid=i.mid,MMMessenger.Post(_w.parent,"Favorite.Remove",f),i.isFav=!i.isFav,n.createInsightsStyleForButtons(u,i.isFav),l()):(t.lfi(i.ns,t.instCl,a(r.id)+"Add"),s(r,t.RequestType.Insights,i,function(n){n&&!n.IsSuccess&&typeof ShowFavErrorMsg!="undefined"&&ShowFavErrorMsg()}),f={},f.mid=i.mid,MMMessenger.Post(_w.parent,"Favorite.Add",f),i.isFav=!i.isFav,n.createInsightsStyleForButtons(u,i.isFav),tt(i,r))};v=function(n){while(n){if(i.hc(n.parentNode,u))return!0;n=n.parentElement}return!1};e=function(n){var r=n.parentElement.parentElement,t=sj_ce("span","","favSavdg"),f=y(b);t.appendChild(f);n.appendChild(t);i.ac(r,u)};n.mark=function(n){if(n&&typeof favresources!="undefined"){var t=sj_ce("span","","favAdded");i.sdt(t,DisplayType.Inline);t.innerHTML=favresources.adtf;n.appendChild(t);_w.setTimeout(function(){it(t)},2e3)}};n.changeDisplayFavoritesButton=function(n,t){var r,u;if(n&&n.length>0)for(r=0;r<n.length;r++)u=i.hc(n[r],"dN"),!u&&t&&i.ac(n[r],"dN"),u&&!t&&i.rc(n[r],"dN")};n.createInsightsStyleForButtons=function(n,t){var f,o,r,e,s;if(n.length>0&&typeof favresources!="undefined")for(f="",o=_ge("salink"),r=0;r<n.length;r++)t?(i.ac(n[r],u),o&&(o.tabIndex=0),f=favresources.rff,sj_evt.fire(c,"Saved")):(i.rc(n[r],u),f=favresources.atf,o&&(o.tabIndex=-1),sj_evt.fire(c,"Unsaved")),e=i.gebc("hint",n[r]),e.length>0&&(e[0].innerHTML=f),e=i.gebc("tooltip_text",n[r]),e.length>0&&(e[0].innerHTML=f),n[r].title=f,i.ha(n[r],h)&&i.sa(n[r],h,f),s=_ge("can_fav_icon"),s&&(i.sa(s,"aria-label",f),s.title=f)};o=function(n){var r=n.parentElement.parentElement,t=i.gebc("favSavdg",n)[0];t&&t.parentNode.removeChild(t);i.rc(r,u)};y=function(n){var t,r=_ge("fav_g_ico");return r&&r.hasChildNodes()?(t=r.childNodes[0].cloneNode(!0),i.ac(t,"favSav")):(t=sj_ce("img","","favImg"),t.src=n),t};s=function(n,u,f,e){var o,h,s;o={};h=f?f.favQ:"";o.query=r?r:h;u==t.RequestType.Insights&&f?(o.query=o.query||"",o.mid=f.mid,o.description=f.title,o.MediaUrl=f.imgUrl,o.SourceUrl=f.pageUrl,o.ThWidth=f.thW,o.ThHeight=f.thH,o.MediaWidth=f.width,o.MediaHeight=f.height,o.MD5=f.md5,o.MediaFormat=f.fmt,o.ThumbnailId=f.thId,o.CollectionType=rt(),o.ContentId=f.ccid):(s=t.gmd(n),o.mid=i.ga(n,"mid"),o.description=i.ga(n,"t1"),s&&(o.ThumbnailId=s.tid,o.MediaUrl=s.imgurl,o.SourceUrl=s.surl,o.ThWidth=s.thW,o.ThHeight=s.thH,o.MediaWidth=s.mw,o.MediaHeight=s.mh,o.MD5=s.md5,o.MediaFormat=s.fmt,o.ContentId=s.cid));t.sxhr(o,t.TransactionType.Write,n,u,e);t.ufcw()};sj_be(_w,"load",d);sj_evt.fire("Favorites.Loaded")}(ImageFavorites||(ImageFavorites={})),function(n){n[n.None=0]="None";n[n.Recommendations=1]="Recommendations";n[n.HP=2]="HP";n[n.Other=3]="Other";n[n.VideoWatchLater=4]="VideoWatchLater";n[n.OfficePinnedImages=5]="OfficePinnedImages";n[n.OfficeRecentlyUsedImages=6]="OfficeRecentlyUsedImages";n[n.Products=7]="Products";n[n.SharedItems=8]="SharedItems"}(CollectionType||(CollectionType={}))